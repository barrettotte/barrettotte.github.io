<!doctype html><html lang=en-us>
<head>
<meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge">
<title> Writing an IBM i Syntax Highlighter for VS Code | Barrett Otte</title>
<link rel=canonical href=https://barrettotte.github.io/posts/2020/2/>
<meta name=viewport content="width=device-width,initial-scale=1">
<link rel=stylesheet href=https://barrettotte.github.io/css/styles.bebfd0fcd5c4beefd5e8db2f541c0a96d3ed6379a3d52507d2293cce9e4ee7a91f7dd86f952d64bdb641436e19695b10c4c2db2da469eee86cf81604e11deb16.css integrity="sha512-vr/Q/NXEvu/V6NsvVBwKltPtY3mj1SUH0ik8zp5O56kffdhvlS1kvbZBQ24ZaVsQxMLbLaRp7uhs+BYE4R3rFg==">
<link rel=stylesheet href=https://barrettotte.github.io/lib/font-awesome/css/all.min.css>
<link rel=stylesheet href=https://barrettotte.github.io/css/custom.css>
<link rel=prefetch href=https://barrettotte.github.io/lib/font-awesome/webfonts/fa-brands-400.woff2 as=font type=font/woff2 crossorigin=anonymous>
<link rel=prefetch href=https://barrettotte.github.io/lib/font-awesome/webfonts/fa-regular-400.woff2 as=font type=font/woff2 crossorigin=anonymous>
<link rel=prefetch href=https://barrettotte.github.io/lib/font-awesome/webfonts/fa-solid-900.woff2 as=font type=font/woff2 crossorigin=anonymous>
<link rel=prefetch href=https://barrettotte.github.io/lib/JetBrainsMono/web/woff2/JetBrainsMono-Regular.woff2 as=font type=font/woff2 crossorigin=anonymous>
<link rel=icon href=https://barrettotte.github.io/img/favicon.svg>
</head>
<body class="max-width mx-auto px3 py5 ltr">
<div class="content index py4"><header id=header>
<div id=title>
<h1><a href=https://barrettotte.github.io>Barrett Otte</a></h1>
<div id=subtitle>
<div class=subtitle-item><a href=https://github.com/barrettotte>Software Engineer</a></div>
<div class=subtitle-item>Tinkerer</div>
<div class=subtitle-item><a href=https://anilist.co/user/barrettotte/>Loser</a></div>
</div>
</div>
<div id=nav>
<div class=nav-item>
<a href=/>Home</a>
</div>
<div class=nav-item>
<a href=/projects>Projects</a>
</div>
<div class=nav-item>
<a href=/posts class=active>Posts</a>
</div>
<div class=nav-item>
<a href=/about>About</a>
</div>
<div class=nav-item>
<a href=https://raw.githubusercontent.com/barrettotte/Resume/master/barrettotte-resume.pdf target=_blank rel="noopener noreferrer">Resume</a>
</div>
<div class=nav-item>
<a href=/misc>Misc</a>
</div>
</div>
</header>
<article class=post>
<header>
<h1 class=posttitle>Writing an IBM i Syntax Highlighter for VS Code</h1>
<div class=meta>
<span class=author>
<span>Barrett Otte</span>
</span>
<div class=postdate>
<time datetime="2020-03-30 00:00:00 +0000 UTC">2020-03-30</time>
</div>
<div class=article-read-time>
<i class="far fa-clock"></i>
4 minute read
</div>
</div>
</header>
<div class=content>
<p><em>Migrated post from <a href=https://dev.to/barrettotte/writing-an-ibmi-syntax-highlighter-for-vs-code-4h0j>DEV.to</a></em></p>
<p><img src=header.PNG alt=header.PNG></p>
<h2 id=introduction>Introduction</h2>
<p>I love VS Code and really want it to be the &ldquo;all in one&rdquo; editor.
Unfortunately, there are still plenty of fringe cases that just don&rsquo;t work yet.</p>
<p>To make a long stort short, I recently started working as an IBMi developer. Its a <strong>midrange system</strong> (the middle ground between standard server and mainframe) that uses an old programming language called <strong>RPG</strong> (<a href=https://en.wikipedia.org/wiki/IBM_RPG>https://en.wikipedia.org/wiki/IBM_RPG</a>, the same era as COBOL and FORTRAN).
So, I decided I wanted to be able to use VS Code to read IBMi code.</p>
<h2 id=time-to-learn-regular-expressions>Time to Learn Regular Expressions</h2>
<p>A couple months ago I didn&rsquo;t know the black magic behind regular expressions.
In a prior side project (<a href=https://github.com/barrettotte/Ranger-Lang>https://github.com/barrettotte/Ranger-Lang</a>) I learned about compiler theory and finite automata.
Which cleared the fog on the reasons why regular expressions exist and a bit of the syntax. I highly suggest taking a bit of time to read through some basic examples of finite automata to get a sense of what I&rsquo;m talking about.</p>
<p>The rest of my learning was messing around for literal hours using <a href=https://regexr.com/>https://regexr.com/</a> . This tool saved my life, it made things so easy to test.</p>
<p>Yes, it took me that long to get the hang of things; you have to be willing to put in the time when you&rsquo;re as dumb as me.</p>
<h2 id=regular-expression-lookaround>Regular Expression Lookaround</h2>
<p>One of the most valuable things to know how to do in regular expressions is lookaround.
A key concept to understand in regular expressions is that once a pattern is matched, the characters matched are &ldquo;eaten&rdquo; by the regex engine (they cannot be reused).
A lookaround allows you to match a pattern ahead or behind and does not consume the characters matched.</p>
<h2 id=regular-expression-example>Regular Expression Example</h2>
<p>For example,
I had to make sure there was an &lsquo;F&rsquo; in column 6, an &lsquo;F&rsquo; or &lsquo;E&rsquo; in column 14, and a certain set of words in column 41.</p>
<p><code> FPRINTER O F 132 OF PRINTER</code></p>
<p>Using positive lookbehind, I can check the &lsquo;F&rsquo;, the &lsquo;F&rsquo; or &lsquo;E&rsquo;, and &lsquo;PRINTER&rsquo; while ensuring that all conditions are matched.</p>
<p>REGEX: <code>(?i)(?&lt;=(?&lt;=(?&lt;=^[\s]{5}F).{8}).{4}(F|E).{20})(WORKSTN|DISK|PRINTER|SPECIAL|SEQ)</code></p>
<p>This regex will lookbehind for two conditions and match a word (WORKSTN&mldr;SEQ) if the prior conditions are matched.</p>
<p>Broken down this is:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span>(?i)               // case insensitive switch
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span>(?&lt;=               // start outer positive lookbehind
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span>  (?&lt;=             // start middle positive lookbehind 
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span>    (?&lt;=           // start inner positive lookbehind
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span>      ^            // beginning of string
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span>      [\s]{5}      // any non-whitespace character 5 times
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span>      F            // &#39;F&#39;
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span>    )              // end inner positive lookbehind
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span>    .{8}           // any character 8 times
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span>  )                // end middle positive lookbehind
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span>.{4}               // any character 4 times
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span>(F|E)              // match either &#39;F&#39; or &#39;E&#39;
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">13</span>.{20}              // any character 20 times
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">14</span>)                  // end outer positive lookbehind
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">15</span>(WORKSTN|...|SEQ)  // match any word in list
</code></pre></div><p>At least for me, this didn&rsquo;t make much sense until I got my hands dirty.</p>
<h2 id=introduction-to-textmate>Introduction to TextMate</h2>
<p>Atom and VS Code both use a thing called <strong>TextMate</strong> to handle all syntax highlighting. It provides a convenient way to list out sets of regular expressions that correspond to parts of a language such as constants, functions, keywords, operators, etc.</p>
<p>Googling around it seems that the TextMate grammars can be written in XML, JSON, and YML. I decided on JSON after screwing around with the YML version and not getting it working correctly (I think).</p>
<p>The previous regular expression example as a TextMate Grammar; I make (WORKSTN|&mldr;|SEQ) highlight as
a constant.</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span>{
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span>  <span style=color:#75715e>// ...
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span style=color:#75715e></span>  <span style=color:#f92672>&#34;constants&#34;</span>: {
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span>    <span style=color:#f92672>&#34;patterns&#34;</span>: [
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span>      {
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span>        <span style=color:#f92672>&#34;name&#34;</span>: <span style=color:#e6db74>&#34;constant.language.rpg.f.device&#34;</span>,
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span>        <span style=color:#f92672>&#34;match&#34;</span>: <span style=color:#e6db74>&#34;(?i)(?&lt;=(?&lt;=(?&lt;=^[\\s]{5}F).{8}).{4}(F|E).{20})(WORKSTN|DISK|PRINTER|SPECIAL|SEQ)&#34;</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span>      }
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span>    ]
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span>  }
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span>  <span style=color:#75715e>// ...
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span><span style=color:#75715e></span>}
</code></pre></div><p>There&rsquo;s also a lot more fancy things you can do with nested patterns, but I won&rsquo;t get into it here. If you&rsquo;re curious read more at <a href=https://www.apeth.com/nonblog/stories/textmatebundle.html>https://www.apeth.com/nonblog/stories/textmatebundle.html</a></p>
<p>For fun, here&rsquo;s a link to Dart&rsquo;s syntax highlighter in TextMate <a href=https://github.com/Dart-Code/Dart-Code/blob/master/syntaxes/dart.json>https://github.com/Dart-Code/Dart-Code/blob/master/syntaxes/dart.json</a></p>
<h2 id=vs-code-language-extension>VS Code Language Extension</h2>
<p>Another reason why I love VS Code is that they provide just enough documentation to get you started and let you go off on your own.</p>
<p>Language extensions are no exception, I just used this documentation page to get started <a href=https://code.visualstudio.com/api/language-extensions/overview>https://code.visualstudio.com/api/language-extensions/overview</a></p>
<p>Everything else was achieved by looking around at existing extensions and screwing around with it.</p>
<h2 id=putting-it-all-together>Putting It All Together</h2>
<p>Using the basic knowledge I wrote above, I sat down one week and just kept hacking away.</p>
<p>For my particular extension, I sat down reading IBM&rsquo;s language documentation and making regex one piece at a time.
By the end of it I made my language extension support DDS, RPG, RPGLE (fixed and free formats), Control Language (CL), and Machine Interface (MI).
You can check out my extension at <a href=https://github.com/barrettotte/vscode-ibmi-languages>https://github.com/barrettotte/vscode-ibmi-languages</a></p>
<h2 id=summary>Summary</h2>
<p>Honestly, its not that hard of work its just insanely tedious and time consuming. But if you don&rsquo;t know how regular expressions really work, here is the perfect excuse to learn.</p>
<p>This is also the perfect weekend project to put on some music, drink some beer, and be a tiny bit productive while not working too hard.</p>
<p><img src=example.PNG alt=example.PNG></p>
</div>
</article>
<footer id=footer>
<div class=footer-left>
&copy; 2022
<a href=/>Barrett Otte</a>
</div>
<div class=footer-right>
<nav>
<ul>
<li>
<a class=icon target=_blank rel=noopener href=mailto:barrettotte@gmail.com>
<i class="fas fa-lg fa-envelope"></i>
</a>
</li>
<li>
<a class=icon target=_blank rel=noopener href=https://github.com/barrettotte>
<i class="fab fa-lg fa-github"></i>
</a>
</li>
<li>
<a class=icon target=_blank rel=noopener href=https://www.linkedin.com/in/barrettotte/>
<i class="fab fa-lg fa-linkedin"></i>
</a>
</li>
<li>
<a class=icon target=_blank rel=noopener href=https://barrettotte.itch.io/>
<i class="fab fa-lg fa-itch-io"></i>
</a>
</li>
</ul>
</nav>
</div>
</footer>
</div>
</body>
<link rel=stylesheet href=https://barrettotte.github.io/lib/font-awesome/css/all.min.css>
<script src=https://barrettotte.github.io/lib/jquery/jquery.min.js></script>
<script src=https://barrettotte.github.io/js/code-copy.js></script>
</html>