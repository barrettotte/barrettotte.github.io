<!doctype html><html lang=en-us>
<head>
<meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge">
<title> Simulating Fishing Rod Bend | Barrett Otte</title>
<link rel=canonical href=https://barrettotte.github.io/posts/2017/1/>
<meta name=viewport content="width=device-width,initial-scale=1">
<link rel=stylesheet href=https://barrettotte.github.io/css/styles.c05d68261bf086a9d7713c4f8a6215a3601608e267a816a7ee58f139b3d1aae51222aae2081c8e0c6bd35e1334773b7a16283022f31f92afd93bb37e5e822e66.css integrity="sha512-wF1oJhvwhqnXcTxPimIVo2AWCOJnqBan7ljxObPRquUSIqriCByODGvTXhM0dzt6FigwIvMfkq/ZO7N+XoIuZg==">
<link rel=stylesheet href=https://barrettotte.github.io/lib/font-awesome/css/all.min.css>
<link rel=stylesheet href=https://barrettotte.github.io/css/custom.css>
<link rel=preload href=https://barrettotte.github.io/lib/font-awesome/webfonts/fa-brands-400.woff2 as=font type=font/woff2 crossorigin=anonymous>
<link rel=preload href=https://barrettotte.github.io/lib/font-awesome/webfonts/fa-regular-400.woff2 as=font type=font/woff2 crossorigin=anonymous>
<link rel=preload href=https://barrettotte.github.io/lib/font-awesome/webfonts/fa-solid-900.woff2 as=font type=font/woff2 crossorigin=anonymous>
<link rel=preload href=https://barrettotte.github.io/lib/JetBrainsMono/web/woff2/JetBrainsMono-Regular.woff2 as=font type=font/woff2 crossorigin=anonymous>
<link rel=icon href=https://barrettotte.github.io/img/favicon.svg>
</head>
<body class="max-width mx-auto px3 py5 ltr">
<div class="content index py4"><header id=header>
<div id=title>
<h1><a href=https://barrettotte.github.io>Barrett Otte</a></h1>
<div id=subtitle>
<div class=subtitle-item><a href=https://github.com/barrettotte>Software Engineer</a></div>
<div class=subtitle-item>Tinkerer</div>
<div class=subtitle-item><a href=https://anilist.co/user/barrettotte/>Loser</a></div>
</div>
</div>
<div id=nav>
<div class=nav-item>
<a href=/>Home</a>
</div>
<div class=nav-item>
<a href=/projects>Projects</a>
</div>
<div class=nav-item>
<a href=/posts class=active>Posts</a>
</div>
<div class=nav-item>
<a href=/about>About</a>
</div>
<div class=nav-item>
<a href=https://raw.githubusercontent.com/barrettotte/Resume/master/barrettotte-resume.pdf target=_blank rel="noopener noreferrer">Resume</a>
</div>
<div class=nav-item>
<a href=/misc>Misc</a>
</div>
</div>
</header>
<article class=post>
<header>
<h1 class=posttitle>Simulating Fishing Rod Bend</h1>
<div class=meta>
<span class=author>
<span>Barrett Otte</span>
</span>
<div class=postdate>
<time datetime="2017-05-01 00:00:00 +0000 UTC">2017-05-01</time>
</div>
<div class=article-read-time>
<i class="far fa-clock"></i>
5 minute read
</div>
</div>
</header>
<div class=content>
<p>Prototype fishing rod bend for an abandoned fishing game.</p>
<p>This uses <a href=https://en.wikipedia.org/wiki/Euler%E2%80%93Bernoulli_beam_theory>Euler Bernoulli Beam Theory</a> to simulate the fishing rod bending.</p>
<p><img src=screenshot-1.PNG alt="Euler Bernoulli Beam Theory"></p>
<p><img src=screenshot-2.PNG alt=screenshot-01></p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c# data-lang=c#><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">  1</span><span style=color:#75715e>// CableComponent.cs
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">  2</span><span style=color:#75715e></span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">  3</span><span style=color:#66d9ef>using</span> UnityEngine;
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">  4</span><span style=color:#66d9ef>using</span> System;
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">  5</span><span style=color:#66d9ef>using</span> System.Collections;
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">  6</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">  7</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">  8</span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>CableComponent</span> : MonoBehaviour {
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">  9</span><span style=color:#a6e22e>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 10</span><span style=color:#a6e22e>	[SerializeField]</span> <span style=color:#66d9ef>private</span> Transform endPoint;
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 11</span><span style=color:#a6e22e>	[SerializeField]</span> <span style=color:#66d9ef>private</span> Material cableMaterial;
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 12</span><span style=color:#a6e22e>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 13</span><span style=color:#a6e22e>	[SerializeField]</span> <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>float</span> cableLength = <span style=color:#ae81ff>0.5f</span>;
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 14</span><span style=color:#a6e22e>	[SerializeField]</span> <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>int</span> totalSegments = <span style=color:#ae81ff>5</span>;
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 15</span><span style=color:#a6e22e>	[SerializeField]</span> <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>float</span> segmentsPerUnit = <span style=color:#ae81ff>2f</span>;
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 16</span>	<span style=color:#66d9ef>private</span> <span style=color:#66d9ef>int</span> segments = <span style=color:#ae81ff>0</span>;
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 17</span><span style=color:#a6e22e>	[SerializeField]</span> <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>float</span> cableWidth = <span style=color:#ae81ff>0.1f</span>;
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 18</span><span style=color:#a6e22e>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 19</span><span style=color:#a6e22e>	[SerializeField]</span> <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>int</span> verletIterations = <span style=color:#ae81ff>1</span>;
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 20</span><span style=color:#a6e22e>	[SerializeField]</span> <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>int</span> solverIterations = <span style=color:#ae81ff>1</span>;
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 21</span><span style=color:#a6e22e>	[SerializeField]</span> <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>float</span> stiffness = <span style=color:#ae81ff>1f</span>;
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 22</span>	<span style=color:#66d9ef>private</span> LineRenderer line;
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 23</span>	<span style=color:#66d9ef>private</span> CableParticle[] points;
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 24</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 25</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 26</span>	<span style=color:#66d9ef>private</span> <span style=color:#66d9ef>void</span> Start() {
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 27</span>		InitCableParticles();
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 28</span>		InitLineRenderer();
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 29</span>	}
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 30</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 31</span>	<span style=color:#66d9ef>private</span> <span style=color:#66d9ef>void</span> Update() {
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 32</span>		RenderCable();
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 33</span>	}
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 34</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 35</span>	<span style=color:#66d9ef>private</span> <span style=color:#66d9ef>void</span> FixedUpdate() {
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 36</span>		VerletIntegrate();
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 37</span>		SolveConstraints();
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 38</span>	}
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 39</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 40</span>	<span style=color:#66d9ef>private</span> <span style=color:#66d9ef>void</span> InitCableParticles(){
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 41</span>		<span style=color:#66d9ef>if</span> (totalSegments &gt; <span style=color:#ae81ff>0</span>) {
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 42</span>			segments = totalSegments;
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 43</span>		} <span style=color:#66d9ef>else</span> {
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 44</span>			segments = Mathf.CeilToInt (cableLength * segmentsPerUnit);
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 45</span>		}
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 46</span>		Vector3 cableDirection = (endPoint.position - transform.position).normalized;
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 47</span>		<span style=color:#66d9ef>float</span> initialSegmentLength = cableLength / segments;
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 48</span>		points = <span style=color:#66d9ef>new</span> CableParticle[segments + <span style=color:#ae81ff>1</span>];
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 49</span>		<span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>int</span> i = <span style=color:#ae81ff>0</span>; i &lt;= segments; i++) {
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 50</span>			Vector3 initialPosition = transform.position + (cableDirection * (initialSegmentLength * i));
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 51</span>			points[i] = <span style=color:#66d9ef>new</span> CableParticle(initialPosition);
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 52</span>		}
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 53</span>		CableParticle start = points[<span style=color:#ae81ff>0</span>];
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 54</span>		CableParticle end = points[segments];
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 55</span>		start.Bind(<span style=color:#66d9ef>this</span>.transform);
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 56</span>		end.Bind(endPoint.transform);
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 57</span>	}
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 58</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 59</span>	<span style=color:#66d9ef>private</span> <span style=color:#66d9ef>void</span> InitLineRenderer() {
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 60</span>		line = <span style=color:#66d9ef>this</span>.gameObject.AddComponent&lt;LineRenderer&gt;();
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 61</span>		line.SetWidth(cableWidth, cableWidth);
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 62</span>		line.SetVertexCount(segments + <span style=color:#ae81ff>1</span>);
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 63</span>		line.material = cableMaterial;
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 64</span>		line.GetComponent&lt;Renderer&gt;().enabled = <span style=color:#66d9ef>true</span>;
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 65</span>	}
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 66</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 67</span>	<span style=color:#66d9ef>private</span> <span style=color:#66d9ef>void</span> RenderCable() {
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 68</span>		<span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>int</span> pointIdx = <span style=color:#ae81ff>0</span>; pointIdx &lt; segments + <span style=color:#ae81ff>1</span>; pointIdx++) {
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 69</span>			line.SetPosition(pointIdx, points [pointIdx].Position);
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 70</span>		}
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 71</span>	}
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 72</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 73</span>	<span style=color:#75715e>// Verlet integration pass -every particle updates its position and speed.
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 74</span><span style=color:#75715e></span>	<span style=color:#66d9ef>private</span> <span style=color:#66d9ef>void</span> VerletIntegrate() {
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 75</span>		Vector3 gravityDisplacement = Time.fixedDeltaTime * Time.fixedDeltaTime * Physics.gravity;
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 76</span>		<span style=color:#66d9ef>foreach</span> (CableParticle particle <span style=color:#66d9ef>in</span> points) {
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 77</span>			particle.UpdateVerlet(gravityDisplacement);
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 78</span>		}
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 79</span>	}
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 80</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 81</span>	<span style=color:#66d9ef>private</span> <span style=color:#66d9ef>void</span> SolveConstraints() {
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 82</span>		SolveDistanceConstraint();
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 83</span>		SolveStiffnessConstraint();
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 84</span>	}
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 85</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 86</span>	<span style=color:#66d9ef>private</span> <span style=color:#66d9ef>void</span> SolveDistanceConstraint() {
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 87</span>		<span style=color:#66d9ef>float</span> segmentLength = cableLength / segments;
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 88</span>		<span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>int</span> i = <span style=color:#ae81ff>0</span>; i &lt; segments; i++) {
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 89</span>			CableParticle particleA = points[i];
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 90</span>			CableParticle particleB = points[i + <span style=color:#ae81ff>1</span>];
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 91</span>			SolveDistanceConstraint(particleA, particleB, segmentLength);
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 92</span>		}
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 93</span>	}
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 94</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 95</span>	<span style=color:#66d9ef>private</span> <span style=color:#66d9ef>void</span> SolveDistanceConstraint(CableParticle particleA, CableParticle particleB, <span style=color:#66d9ef>float</span> segmentLength) {
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 96</span>		Vector3 delta = particleB.Position - particleA.Position;
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 97</span>		<span style=color:#66d9ef>float</span> currentDistance = delta.magnitude;
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 98</span>		<span style=color:#66d9ef>float</span> errorFactor = (currentDistance - segmentLength) / currentDistance;
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 99</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">100</span>		<span style=color:#75715e>// Only move free particles to satisfy constraints
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">101</span><span style=color:#75715e></span>		<span style=color:#66d9ef>if</span> (particleA.IsFree() &amp;&amp; particleB.IsFree()) {
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">102</span>			particleA.Position += errorFactor * <span style=color:#ae81ff>0.5f</span> * delta;
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">103</span>			particleB.Position -= errorFactor * <span style=color:#ae81ff>0.5f</span> * delta;
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">104</span>		} <span style=color:#66d9ef>else</span> <span style=color:#66d9ef>if</span> (particleA.IsFree()) {
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">105</span>			particleA.Position += errorFactor * delta;
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">106</span>		} <span style=color:#66d9ef>else</span> <span style=color:#66d9ef>if</span> (particleB.IsFree()) {
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">107</span>			particleB.Position -= errorFactor * delta;
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">108</span>		}
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">109</span>	}
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">110</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">111</span>	<span style=color:#66d9ef>private</span> <span style=color:#66d9ef>void</span> SolveStiffnessConstraint() {
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">112</span>		<span style=color:#66d9ef>float</span> distance = (points[<span style=color:#ae81ff>0</span>].Position - points[segments].Position).magnitude;
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">113</span>		<span style=color:#66d9ef>if</span> (distance &gt; cableLength) {
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">114</span>			<span style=color:#66d9ef>foreach</span> (CableParticle particle <span style=color:#66d9ef>in</span> points) {
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">115</span>				SolveStiffnessConstraint(particle, distance);
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">116</span>			}
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">117</span>		}	
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">118</span>	}
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">119</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">120</span>	<span style=color:#75715e>/**
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">121</span><span style=color:#75715e>	 * TODO: I&#39;ll implement this constraint to reinforce cable stiffness 
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">122</span><span style=color:#75715e>	 * As the system has more particles, the verlet integration aproach 
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">123</span><span style=color:#75715e>	 * may get way too loose cable simulation. This constraint is intended to reinforce the cable stiffness.
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">124</span><span style=color:#75715e>	 * // throw new System.NotImplementedException ();
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">125</span><span style=color:#75715e>	**/</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">126</span>	<span style=color:#66d9ef>void</span> SolveStiffnessConstraint(CableParticle cableParticle, <span style=color:#66d9ef>float</span> distance) {
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">127</span>	}
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">128</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">129</span>}
</code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c# data-lang=c#><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span style=color:#75715e>// CableParticle.cs
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span style=color:#75715e></span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span style=color:#66d9ef>using</span> System.Collections;
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>CableParticle</span> {
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span>	<span style=color:#66d9ef>private</span> Vector3 <span style=color:#ae81ff>_</span>position, <span style=color:#ae81ff>_</span>oldPosition;
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span>	<span style=color:#66d9ef>private</span> Transform <span style=color:#ae81ff>_</span>boundTo = <span style=color:#66d9ef>null</span>;
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span>	<span style=color:#66d9ef>private</span> Rigidbody <span style=color:#ae81ff>_</span>boundRigid = <span style=color:#66d9ef>null</span>;
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span>	<span style=color:#66d9ef>public</span> Vector3 Position {
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">13</span>		<span style=color:#66d9ef>get</span> { <span style=color:#66d9ef>return</span> <span style=color:#ae81ff>_</span>position; }
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">14</span>		<span style=color:#66d9ef>set</span> { <span style=color:#ae81ff>_</span>position = <span style=color:#66d9ef>value</span>; }
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">15</span>	}
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">16</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">17</span>	<span style=color:#66d9ef>public</span> Vector3 Velocity {
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">18</span>		<span style=color:#66d9ef>get</span> { <span style=color:#66d9ef>return</span> (<span style=color:#ae81ff>_</span>position - <span style=color:#ae81ff>_</span>oldPosition); }
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">19</span>	}
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">20</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">21</span>	<span style=color:#66d9ef>public</span> CableParticle(Vector3 newPosition) {
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">22</span>		<span style=color:#ae81ff>_</span>oldPosition = <span style=color:#ae81ff>_</span>position = newPosition;
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">23</span>	}
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">24</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">25</span>	<span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> UpdateVerlet(Vector3 gravityDisplacement) {
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">26</span>		<span style=color:#66d9ef>if</span> (<span style=color:#66d9ef>this</span>.IsBound()) {
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">27</span>			<span style=color:#66d9ef>if</span> (<span style=color:#ae81ff>_</span>boundRigid == <span style=color:#66d9ef>null</span>) {
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">28</span>				<span style=color:#66d9ef>this</span>.UpdatePosition(<span style=color:#ae81ff>_</span>boundTo.position);		
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">29</span>			} <span style=color:#66d9ef>else</span> {
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">30</span>				<span style=color:#66d9ef>switch</span> (<span style=color:#ae81ff>_</span>boundRigid.interpolation) {
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">31</span>					<span style=color:#66d9ef>case</span> RigidbodyInterpolation.Interpolate:
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">32</span>						<span style=color:#66d9ef>this</span>.UpdatePosition(<span style=color:#ae81ff>_</span>boundRigid.position + (<span style=color:#ae81ff>_</span>boundRigid.velocity * Time.fixedDeltaTime) / <span style=color:#ae81ff>2</span>);
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">33</span>						<span style=color:#66d9ef>break</span>;
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">34</span>					<span style=color:#66d9ef>case</span> RigidbodyInterpolation.None:
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">35</span>					<span style=color:#66d9ef>default</span>:
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">36</span>						<span style=color:#66d9ef>this</span>.UpdatePosition(<span style=color:#ae81ff>_</span>boundRigid.position + <span style=color:#ae81ff>_</span>boundRigid.velocity * Time.fixedDeltaTime);
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">37</span>					<span style=color:#66d9ef>break</span>;
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">38</span>				}
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">39</span>			}
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">40</span>		} <span style=color:#66d9ef>else</span> {
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">41</span>			Vector3 newPosition = <span style=color:#66d9ef>this</span>.Position + <span style=color:#66d9ef>this</span>.Velocity + gravityDisplacement;
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">42</span>			<span style=color:#66d9ef>this</span>.UpdatePosition(newPosition);
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">43</span>		}
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">44</span>	}
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">45</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">46</span>	<span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> UpdatePosition(Vector3 newPos) {
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">47</span>		<span style=color:#ae81ff>_</span>oldPosition = <span style=color:#ae81ff>_</span>position;
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">48</span>		<span style=color:#ae81ff>_</span>position = newPos;
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">49</span>	}
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">50</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">51</span>	<span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> Bind(Transform to) {
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">52</span>		<span style=color:#ae81ff>_</span>boundTo = to;
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">53</span>		<span style=color:#ae81ff>_</span>boundRigid = to.GetComponent&lt;Rigidbody&gt;();
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">54</span>		<span style=color:#ae81ff>_</span>oldPosition = <span style=color:#ae81ff>_</span>position = <span style=color:#ae81ff>_</span>boundTo.position;
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">55</span>	}
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">56</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">57</span>	<span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> UnBind() {
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">58</span>		<span style=color:#ae81ff>_</span>boundTo = <span style=color:#66d9ef>null</span>;
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">59</span>		<span style=color:#ae81ff>_</span>boundRigid = <span style=color:#66d9ef>null</span>;
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">60</span>	}
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">61</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">62</span>	<span style=color:#66d9ef>public</span> <span style=color:#66d9ef>bool</span> IsFree() {
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">63</span>		<span style=color:#66d9ef>return</span> (<span style=color:#ae81ff>_</span>boundTo == <span style=color:#66d9ef>null</span>);
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">64</span>	}
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">65</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">66</span>	<span style=color:#66d9ef>public</span> <span style=color:#66d9ef>bool</span> IsBound() {
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">67</span>		<span style=color:#66d9ef>return</span> (<span style=color:#ae81ff>_</span>boundTo != <span style=color:#66d9ef>null</span>);
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">68</span>	}
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">69</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">70</span>}
</code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c# data-lang=c#><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span style=color:#75715e>// FishingRodBend.cs
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span style=color:#75715e></span><span style=color:#66d9ef>using</span> UnityEngine;
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span style=color:#66d9ef>using</span> System.Collections;
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>FishingRodBend</span> : MonoBehaviour {
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span>	<span style=color:#66d9ef>private</span> Transform[] bendyInterpolationPoints;
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span>	<span style=color:#66d9ef>private</span> Transform[] rigidInterpolationPoints;
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span>	<span style=color:#66d9ef>private</span> Transform[] deflectedPoints;
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span>	<span style=color:#66d9ef>public</span> Transform deflectedParent;
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span>	<span style=color:#66d9ef>public</span> Transform rigidPointParent;
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">13</span>	<span style=color:#66d9ef>public</span> Transform bendyPointParent;
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">14</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">15</span>	<span style=color:#66d9ef>public</span> GameObject pointPrefab;
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">16</span>	<span style=color:#66d9ef>public</span> Material redMat;
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">17</span>	<span style=color:#66d9ef>public</span> Material greenMat;
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">18</span>	<span style=color:#66d9ef>public</span> Material purpleMat;
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">19</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">20</span>	<span style=color:#66d9ef>private</span> <span style=color:#66d9ef>float</span> rodLength;
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">21</span>	<span style=color:#66d9ef>private</span> <span style=color:#66d9ef>int</span> interpolationAmount;
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">22</span>	<span style=color:#66d9ef>private</span> <span style=color:#66d9ef>float</span> interpolationRatio;
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">23</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">24</span>	<span style=color:#66d9ef>private</span> <span style=color:#66d9ef>void</span> Start() {
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">25</span>		rodLength = <span style=color:#ae81ff>12.0f</span>;
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">26</span>		interpolationAmount = <span style=color:#ae81ff>16</span>;
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">27</span>		interpolationRatio = rodLength / interpolationAmount;
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">28</span>		bendyInterpolationPoints = <span style=color:#66d9ef>new</span> Transform[interpolationAmount];
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">29</span>		rigidInterpolationPoints = <span style=color:#66d9ef>new</span> Transform[interpolationAmount];
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">30</span>		deflectedPoints = <span style=color:#66d9ef>new</span> Transform[interpolationAmount];
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">31</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">32</span>		CreatePoints (bendyInterpolationPoints, greenMat, bendyPointParent);
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">33</span>		CreatePoints (rigidInterpolationPoints, redMat, rigidPointParent);
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">34</span>		CreatePoints (deflectedPoints, purpleMat, deflectedParent);
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">35</span>	}
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">36</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">37</span>	<span style=color:#66d9ef>private</span> <span style=color:#66d9ef>void</span> FixedUpdate() {
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">38</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">39</span>		<span style=color:#75715e>// Interpolate the points for the deflection
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">40</span><span style=color:#75715e></span>		<span style=color:#66d9ef>for</span>(<span style=color:#66d9ef>int</span> i = <span style=color:#ae81ff>0</span>; i &lt; interpolationAmount; i++) {
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">41</span>			Vector3 a = rigidInterpolationPoints [i].position;
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">42</span>			Vector3 b = bendyInterpolationPoints [i].position;
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">43</span>			deflectedPoints [i].position = a + (b - a) * Deflection((i * interpolationRatio) + interpolationRatio);
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">44</span>		}
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">45</span>	}
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">46</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">47</span>	<span style=color:#75715e>//	Euler-Bernoull : Beam Theory -&gt; Cantilever beam with end load, derived formula
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">48</span><span style=color:#75715e></span>	<span style=color:#66d9ef>private</span> <span style=color:#66d9ef>float</span> Deflection(<span style=color:#66d9ef>float</span> x) {
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">49</span>		<span style=color:#66d9ef>return</span> ((x * x) * (<span style=color:#ae81ff>3</span> * rodLength - x) ) / (<span style=color:#ae81ff>2</span> * (rodLength * rodLength * rodLength));
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">50</span>	}
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">51</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">52</span>	<span style=color:#75715e>/* Helper method, used to create three sets of points for calculation */</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">53</span>	<span style=color:#66d9ef>private</span> <span style=color:#66d9ef>void</span> CreatePoints(Transform[] points, Material m, Transform parent) {
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">54</span>		<span style=color:#66d9ef>for</span>(<span style=color:#66d9ef>int</span> i = <span style=color:#ae81ff>0</span>; i &lt; interpolationAmount; i++) {
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">55</span>			<span style=color:#66d9ef>float</span> currentZ = i * interpolationRatio;
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">56</span>			GameObject tmp = (GameObject)Instantiate (pointPrefab);
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">57</span>			tmp.transform.SetParent (parent);
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">58</span>			tmp.transform.name = <span style=color:#e6db74>&#34;Point (&#34;</span> + (i+<span style=color:#ae81ff>1</span>) + <span style=color:#e6db74>&#34;)&#34;</span>;
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">59</span>			tmp.transform.localPosition = <span style=color:#66d9ef>new</span> Vector3 (<span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0.0f</span>, currentZ);
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">60</span>			tmp.transform.localScale = <span style=color:#66d9ef>new</span> Vector3 (<span style=color:#ae81ff>0.25f</span>, <span style=color:#ae81ff>0.25f</span>, <span style=color:#ae81ff>0.25f</span>);
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">61</span>			tmp.gameObject.GetComponent&lt;Renderer&gt; ().sharedMaterial = m;
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">62</span>			points [i] = tmp.transform;
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">63</span>		}
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">64</span>	}
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">65</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">66</span>}
</code></pre></div>
</div>
</article>
<footer id=footer>
<div class=footer-left>
&copy; 2022
<a href=/>Barrett Otte</a>
</div>
<div class=footer-right>
<nav>
<ul>
<li>
<a class=icon target=_blank rel=noopener href=mailto:barrettotte@gmail.com>
<i class="fas fa-lg fa-envelope"></i>
</a>
</li>
<li>
<a class=icon target=_blank rel=noopener href=https://github.com/barrettotte>
<i class="fab fa-lg fa-github"></i>
</a>
</li>
<li>
<a class=icon target=_blank rel=noopener href=https://www.linkedin.com/in/barrettotte/>
<i class="fab fa-lg fa-linkedin"></i>
</a>
</li>
<li>
<a class=icon target=_blank rel=noopener href="https://news.ycombinator.com/user?id=barrettotte">
<i class="fab fa-lg fa-hacker-news-square"></i>
</a>
</li>
<li>
<a class=icon target=_blank rel=noopener href=https://barrettotte.itch.io/>
<i class="fab fa-lg fa-itch-io"></i>
</a>
</li>
<li>
<a class=icon target=_blank rel=noopener href=https://www.kaggle.com/barrettotte>
<i class="fab fa-lg fa-kaggle"></i>
</a>
</li>
</ul>
</nav>
</div>
</footer>
</div>
</body>
<link rel=stylesheet href=/lib/font-awesome/css/all.min.css>
<script src=/lib/jquery/jquery.min.js></script>
<script src=/js/code-copy.js></script>
</html>