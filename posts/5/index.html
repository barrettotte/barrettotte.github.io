<!doctype html><html lang=en-us>
<head>
<meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge">
<title> Utility to Pull Code from IBM i | Barrett Otte</title>
<link rel=canonical href=https://barrettotte.github.io/posts/5/>
<meta name=viewport content="width=device-width,initial-scale=1">
<link rel=stylesheet href=https://barrettotte.github.io/css/styles.c05d68261bf086a9d7713c4f8a6215a3601608e267a816a7ee58f139b3d1aae51222aae2081c8e0c6bd35e1334773b7a16283022f31f92afd93bb37e5e822e66.css integrity="sha512-wF1oJhvwhqnXcTxPimIVo2AWCOJnqBan7ljxObPRquUSIqriCByODGvTXhM0dzt6FigwIvMfkq/ZO7N+XoIuZg==">
<link rel=stylesheet href=https://barrettotte.github.io/lib/font-awesome/css/all.min.css>
<link rel=stylesheet href=https://barrettotte.github.io/css/custom.css>
<link rel=preload href=https://barrettotte.github.io/lib/font-awesome/webfonts/fa-brands-400.woff2 as=font type=font/woff2 crossorigin=anonymous>
<link rel=preload href=https://barrettotte.github.io/lib/font-awesome/webfonts/fa-regular-400.woff2 as=font type=font/woff2 crossorigin=anonymous>
<link rel=preload href=https://barrettotte.github.io/lib/font-awesome/webfonts/fa-solid-900.woff2 as=font type=font/woff2 crossorigin=anonymous>
<link rel=preload href=https://barrettotte.github.io/lib/JetBrainsMono/web/woff2/JetBrainsMono-Regular.woff2 as=font type=font/woff2 crossorigin=anonymous>
<link rel=icon href=https://barrettotte.github.io/img/favicon.svg>
</head>
<body class="max-width mx-auto px3 py5 ltr">
<div class="content index py4"><header id=header>
<div id=title>
<h1><a href=https://barrettotte.github.io>Barrett Otte</a></h1>
<div id=subtitle>
<div class=subtitle-item><a href=https://github.com/barrettotte>Software Engineer</a></div>
<div class=subtitle-item>Tinkerer</div>
<div class=subtitle-item><a href=https://anilist.co/user/barrettotte/>Loser</a></div>
</div>
</div>
<div id=nav>
<div class=nav-item>
<a href=/>Home</a>
</div>
<div class=nav-item>
<a href=/projects>Projects</a>
</div>
<div class=nav-item>
<a class=active href=/posts>Posts</a>
</div>
<div class=nav-item>
<a href=/about>About</a>
</div>
<div class=nav-item>
<a href=https://raw.githubusercontent.com/barrettotte/Resume/master/barrettotte-resume.pdf>Resume</a>
</div>
<div class=nav-item>
<a href=/misc>Misc</a>
</div>
</div>
</header>
<article class=post>
<header>
<h1 class=posttitle>Utility to Pull Code from IBM i</h1>
<div class=meta>
<span class=author>
<span>Barrett Otte</span>
</span>
<div class=postdate>
<time datetime="2019-08-19 00:00:00 +0000 UTC">2019-08-19</time>
</div>
<div class=article-read-time>
<i class="far fa-clock"></i>
4 minute read
</div>
</div>
</header>
<div class=content>
<p><em>Migrated post from <a href=https://dev.to/barrettotte/simple-util-to-pull-code-from-the-ibmi-5hfp>DEV.to</a></em></p>
<p><img src=header.PNG alt=header.PNG></p>
<p>In one of my really dumb side projects I&rsquo;m making, I have some IBM i code that I&rsquo;d like to keep in my git repository with some other stuff. I could use the Integrated File System (IFS), but truthfully I don&rsquo;t know enough about IBM i yet to use it correctly.</p>
<p>So, in the meantime I have a quick and dirty python script that lets me pull multiple source members based on a config file, repo.json. This isn&rsquo;t the cleanest, but it works pretty well.</p>
<p>My repo.json is very basic, but lays out a basic IBM i file structure to loop over below with FTP</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span>{
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span>  <span style=color:#f92672>&#34;library&#34;</span>: <span style=color:#e6db74>&#34;BOLIB&#34;</span>,
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span>  <span style=color:#f92672>&#34;spfs&#34;</span>: [
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span>    {
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span>      <span style=color:#f92672>&#34;name&#34;</span>: <span style=color:#e6db74>&#34;QRPGLESRC&#34;</span>,
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span>      <span style=color:#f92672>&#34;extension&#34;</span>: <span style=color:#e6db74>&#34;RPGLE&#34;</span>,
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span>      <span style=color:#f92672>&#34;members&#34;</span>: [
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span>        {
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span>          <span style=color:#f92672>&#34;name&#34;</span>: <span style=color:#e6db74>&#34;FIZZBUZZ&#34;</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span>        }
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span>      ]
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span>    }
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">13</span>  ],
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">14</span>  <span style=color:#f92672>&#34;output&#34;</span>: <span style=color:#e6db74>&#34;./&#34;</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">15</span>}
</code></pre></div><h2 id=basic-idea>Basic Idea</h2>
<p>If you connect to IBM i over SSH you can navigate and find your source members. For example, I&rsquo;m going to drill down into my QRPGLESRC file within my BOLIB library.</p>
<p><img src=terminal.PNG alt=terminal.PNG></p>
<p>As you can see, there are my QRPGLESRC members hanging out. All my script does is automate grabbing the source members.</p>
<h2 id=the-code>The Code</h2>
<p>To start, I use a few basic modules found in the python standard library.</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span style=color:#f92672>import</span> ftplib  <span style=color:#75715e># easily setup FTP connection</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span style=color:#f92672>import</span> json    <span style=color:#75715e># read in repo.json config file</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span style=color:#f92672>import</span> getpass <span style=color:#75715e># used to discretely get password</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span><span style=color:#f92672>import</span> os      <span style=color:#75715e># used to safely make directories for output</span>
</code></pre></div><p>I load my config file, instantiate my FTP client, and get the hostname, username, and password from the console</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span>config <span style=color:#f92672>=</span> {}
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span style=color:#66d9ef>with</span> open(<span style=color:#e6db74>&#34;./repo.json&#34;</span>, <span style=color:#e6db74>&#39;r&#39;</span>) <span style=color:#66d9ef>as</span> f: 
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span>  config <span style=color:#f92672>=</span> json<span style=color:#f92672>.</span>load(f)
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">5</span>ftp_client <span style=color:#f92672>=</span> ftplib<span style=color:#f92672>.</span>FTP()
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">6</span>host <span style=color:#f92672>=</span> input(<span style=color:#e6db74>&#34;Enter Host: &#34;</span>)
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">7</span>user   <span style=color:#f92672>=</span> input(<span style=color:#e6db74>&#34;Enter User: &#34;</span>)
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">8</span>password <span style=color:#f92672>=</span> getpass<span style=color:#f92672>.</span>getpass(<span style=color:#e6db74>&#34;Enter Password: &#34;</span>)
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">9</span><span style=color:#75715e># FTP logic below...</span>
</code></pre></div><p>Next, I setup my FTP connection shell with very basic error handling</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span style=color:#66d9ef>try</span>:
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span>  ftp_client<span style=color:#f92672>.</span>connect(host, timeout<span style=color:#f92672>=</span><span style=color:#ae81ff>10000</span>)
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span>  ftp_client<span style=color:#f92672>.</span>login(user, password)
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span>  <span style=color:#75715e># The meat of the code here ...</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span style=color:#66d9ef>except</span> ftplib<span style=color:#f92672>.</span>all_errors <span style=color:#66d9ef>as</span> e:
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span>  print(<span style=color:#e6db74>&#34;Error occurred with FTP.</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span> <span style=color:#f92672>+</span> str(e))
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span>  exit(<span style=color:#ae81ff>1</span>)
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span style=color:#66d9ef>except</span> <span style=color:#a6e22e>Exception</span> <span style=color:#66d9ef>as</span> e:
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span>  print(<span style=color:#e6db74>&#34;Some other error occurred</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span> <span style=color:#f92672>+</span> str(e))
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span>  exit(<span style=color:#ae81ff>1</span>)
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span style=color:#66d9ef>finally</span>:
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span>  ftp_client<span style=color:#f92672>.</span>quit()
</code></pre></div><p>Now the fun stuff, sending FTP RETR command to get data from IBM i</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span>lib <span style=color:#f92672>=</span> config[<span style=color:#e6db74>&#39;library&#39;</span>] <span style=color:#75715e># my example only has one library, so no looping</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span style=color:#66d9ef>for</span> spf <span style=color:#f92672>in</span> config[<span style=color:#e6db74>&#39;spfs&#39;</span>]:
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span>  print(<span style=color:#e6db74>&#34;Fetching member(s) from </span><span style=color:#e6db74>{}</span><span style=color:#e6db74>/</span><span style=color:#e6db74>{}</span><span style=color:#e6db74>&#34;</span><span style=color:#f92672>.</span>format(lib, spf[<span style=color:#e6db74>&#39;name&#39;</span>]))
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span>  <span style=color:#66d9ef>if</span> <span style=color:#f92672>not</span> os<span style=color:#f92672>.</span>path<span style=color:#f92672>.</span>exists(<span style=color:#e6db74>&#39;./&#39;</span><span style=color:#f92672>+</span>spf[<span style=color:#e6db74>&#39;name&#39;</span>]): 
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span>    os<span style=color:#f92672>.</span>makedirs(spf[<span style=color:#e6db74>&#39;name&#39;</span>]) <span style=color:#75715e># make a directory based on source physical file name</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span>    <span style=color:#66d9ef>for</span> mbr <span style=color:#f92672>in</span> spf[<span style=color:#e6db74>&#39;members&#39;</span>]:
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span>      resp <span style=color:#f92672>=</span> []
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span>      <span style=color:#75715e># The magic command to get data  ex: BOLIB/QRPGLESRC/FIZZBUZZ.mbr</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">13</span>      cmd <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;RETR </span><span style=color:#e6db74>{}</span><span style=color:#e6db74>&#34;</span><span style=color:#f92672>.</span>format(<span style=color:#e6db74>&#34;/QSYS.lib/</span><span style=color:#e6db74>{}</span><span style=color:#e6db74>.lib/</span><span style=color:#e6db74>{}</span><span style=color:#e6db74>.file/</span><span style=color:#e6db74>{}</span><span style=color:#e6db74>.mbr&#34;</span>)<span style=color:#f92672>.</span>format(
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">14</span>        lib, spf[<span style=color:#e6db74>&#39;name&#39;</span>], mbr[<span style=color:#e6db74>&#39;name&#39;</span>])
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">15</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">16</span>      ftp_client<span style=color:#f92672>.</span>retrlines(cmd, resp<span style=color:#f92672>.</span>append) <span style=color:#75715e># run the command</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">17</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">18</span>      <span style=color:#75715e># Create file based on specified extension ex: RPGLE</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">19</span>      filepath <span style=color:#f92672>=</span> spf[<span style=color:#e6db74>&#39;name&#39;</span>] <span style=color:#f92672>+</span> <span style=color:#e6db74>&#39;/&#39;</span> <span style=color:#f92672>+</span> mbr[<span style=color:#e6db74>&#39;name&#39;</span>] <span style=color:#f92672>+</span> <span style=color:#e6db74>&#39;.&#39;</span> <span style=color:#f92672>+</span> spf[<span style=color:#e6db74>&#39;extension&#39;</span>]
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">20</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">21</span>      <span style=color:#75715e># Finally, write data to file</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">22</span>      <span style=color:#66d9ef>with</span> open(filepath, <span style=color:#e6db74>&#39;w+&#39;</span>) <span style=color:#66d9ef>as</span> f:
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">23</span>        <span style=color:#66d9ef>for</span> line <span style=color:#f92672>in</span> resp: f<span style=color:#f92672>.</span>write(str(line) <span style=color:#f92672>+</span> <span style=color:#e6db74>&#39;</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#39;</span>)
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">24</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">25</span>      print(<span style=color:#e6db74>&#34;  Saved &#34;</span> <span style=color:#f92672>+</span> filepath)
</code></pre></div><h2 id=final-script>Final Script</h2>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span style=color:#f92672>import</span> ftplib  <span style=color:#75715e># easily setup FTP connection</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span style=color:#f92672>import</span> json    <span style=color:#75715e># read in repo.json config file</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span style=color:#f92672>import</span> getpass <span style=color:#75715e># used to discretely get password</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span style=color:#f92672>import</span> os      <span style=color:#75715e># used to safely make directories for output</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span>config <span style=color:#f92672>=</span> {}
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span style=color:#66d9ef>with</span> open(<span style=color:#e6db74>&#34;./repo.json&#34;</span>, <span style=color:#e6db74>&#39;r&#39;</span>) <span style=color:#66d9ef>as</span> f: 
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span>  config <span style=color:#f92672>=</span> json<span style=color:#f92672>.</span>load(f)
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span>ftp_client <span style=color:#f92672>=</span> ftplib<span style=color:#f92672>.</span>FTP()
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span>host <span style=color:#f92672>=</span> input(<span style=color:#e6db74>&#34;Enter Host: &#34;</span>)
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span>user   <span style=color:#f92672>=</span> input(<span style=color:#e6db74>&#34;Enter User: &#34;</span>)
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">13</span>password <span style=color:#f92672>=</span> getpass<span style=color:#f92672>.</span>getpass(<span style=color:#e6db74>&#34;Enter Password: &#34;</span>)
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">14</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">15</span><span style=color:#66d9ef>try</span>:
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">16</span>  ftp_client<span style=color:#f92672>.</span>connect(host, timeout<span style=color:#f92672>=</span><span style=color:#ae81ff>10000</span>)
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">17</span>  ftp_client<span style=color:#f92672>.</span>login(user, password)
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">18</span>  
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">19</span>  lib <span style=color:#f92672>=</span> config[<span style=color:#e6db74>&#39;library&#39;</span>] <span style=color:#75715e># my example only has one library, so no looping</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">20</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">21</span>  <span style=color:#66d9ef>for</span> spf <span style=color:#f92672>in</span> config[<span style=color:#e6db74>&#39;spfs&#39;</span>]:
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">22</span>    print(<span style=color:#e6db74>&#34;Fetching member(s) from </span><span style=color:#e6db74>{}</span><span style=color:#e6db74>/</span><span style=color:#e6db74>{}</span><span style=color:#e6db74>&#34;</span><span style=color:#f92672>.</span>format(lib, spf[<span style=color:#e6db74>&#39;name&#39;</span>]))
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">23</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">24</span>    <span style=color:#66d9ef>if</span> <span style=color:#f92672>not</span> os<span style=color:#f92672>.</span>path<span style=color:#f92672>.</span>exists(<span style=color:#e6db74>&#39;./&#39;</span><span style=color:#f92672>+</span>spf[<span style=color:#e6db74>&#39;name&#39;</span>]): 
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">25</span>      os<span style=color:#f92672>.</span>makedirs(spf[<span style=color:#e6db74>&#39;name&#39;</span>]) <span style=color:#75715e># make a directory based on source physical file name</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">26</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">27</span>    <span style=color:#66d9ef>for</span> mbr <span style=color:#f92672>in</span> spf[<span style=color:#e6db74>&#39;members&#39;</span>]:
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">28</span>      resp <span style=color:#f92672>=</span> []
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">29</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">30</span>      <span style=color:#75715e># The magic command to get data  ex: BOLIB/QRPGLESRC/FIZZBUZZ.mbr</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">31</span>      cmd <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;RETR </span><span style=color:#e6db74>{}</span><span style=color:#e6db74>&#34;</span><span style=color:#f92672>.</span>format(<span style=color:#e6db74>&#34;/QSYS.lib/</span><span style=color:#e6db74>{}</span><span style=color:#e6db74>.lib/</span><span style=color:#e6db74>{}</span><span style=color:#e6db74>.file/</span><span style=color:#e6db74>{}</span><span style=color:#e6db74>.mbr&#34;</span>)<span style=color:#f92672>.</span>format(
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">32</span>        lib, spf[<span style=color:#e6db74>&#39;name&#39;</span>], mbr[<span style=color:#e6db74>&#39;name&#39;</span>])
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">33</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">34</span>      ftp_client<span style=color:#f92672>.</span>retrlines(cmd, resp<span style=color:#f92672>.</span>append) <span style=color:#75715e># run the command</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">35</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">36</span>      <span style=color:#75715e># Create file based on specified extension ex: RPGLE</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">37</span>      filepath <span style=color:#f92672>=</span> spf[<span style=color:#e6db74>&#39;name&#39;</span>] <span style=color:#f92672>+</span> <span style=color:#e6db74>&#39;/&#39;</span> <span style=color:#f92672>+</span> mbr[<span style=color:#e6db74>&#39;name&#39;</span>] <span style=color:#f92672>+</span> <span style=color:#e6db74>&#39;.&#39;</span> <span style=color:#f92672>+</span> spf[<span style=color:#e6db74>&#39;extension&#39;</span>]
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">38</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">39</span>      <span style=color:#75715e># Finally, write data to file</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">40</span>      <span style=color:#66d9ef>with</span> open(filepath, <span style=color:#e6db74>&#39;w+&#39;</span>) <span style=color:#66d9ef>as</span> f:
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">41</span>        <span style=color:#66d9ef>for</span> line <span style=color:#f92672>in</span> resp: f<span style=color:#f92672>.</span>write(str(line) <span style=color:#f92672>+</span> <span style=color:#e6db74>&#39;</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#39;</span>)
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">42</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">43</span>      print(<span style=color:#e6db74>&#34;  Saved &#34;</span> <span style=color:#f92672>+</span> filepath)
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">44</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">45</span><span style=color:#66d9ef>except</span> ftplib<span style=color:#f92672>.</span>all_errors <span style=color:#66d9ef>as</span> e:
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">46</span>  print(<span style=color:#e6db74>&#34;Error occurred with FTP.</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span> <span style=color:#f92672>+</span> str(e))
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">47</span>  exit(<span style=color:#ae81ff>1</span>)
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">48</span><span style=color:#66d9ef>except</span> <span style=color:#a6e22e>Exception</span> <span style=color:#66d9ef>as</span> e:
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">49</span>  print(<span style=color:#e6db74>&#34;Some other error occurred</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span> <span style=color:#f92672>+</span> str(e))
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">50</span>  exit(<span style=color:#ae81ff>1</span>)
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">51</span><span style=color:#66d9ef>finally</span>:
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">52</span>  ftp_client<span style=color:#f92672>.</span>quit()
</code></pre></div><h2 id=the-file-was-fetched>The File was Fetched!</h2>
<p>This is stored in ./QRPGLESRC/FIZZBUZZ.RPGLE</p>
<pre tabindex=0><code>       /free
       // The classic fizzbuzz program in RPGLE Free
       dcl-s num int(10);

       for num = 1 to 100;
           if %REM(num:3) = 0 and %REM(num:5) = 0;
               dsply ('num - ' + %char(num) + ' FIZZBUZZ');
           elseif %rem(num:3) = 0;
               dsply ('num - ' + %char(num) + ' FIZZ');
           elseif %rem(num:5) = 0;
               dsply ('num - ' + %char(num) + ' BUZZ');
           else;
               dsply ('num - ' + %char(num));
           endif;
       endfor;
       *INLR = *ON;
</code></pre><h2 id=simple-batch-script>Simple Batch script</h2>
<p>In my repository, I made a little batch script so I could pull IBM i code and commit it with the rest of my repository in one call.</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span>@ECHO OFF
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span>IF <span style=color:#f92672>[</span>%1<span style=color:#f92672>]</span> <span style=color:#f92672>==</span> <span style=color:#f92672>[]</span> GOTO NOMSG
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span>python ibmi-pull.py <span style=color:#f92672>&amp;&amp;</span> git add . <span style=color:#f92672>&amp;&amp;</span> git commit -m <span style=color:#e6db74>&#34;%~1&#34;</span> <span style=color:#f92672>&amp;&amp;</span> git push origin master
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span>GOTO END
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">5</span>:NOMSG
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">6</span>  ECHO <span style=color:#e6db74>&#34;Enter the commit message!&#34;</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">7</span>:END
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">8</span>PAUSE
</code></pre></div><p>Again, there&rsquo;s probably some better &ldquo;tools&rdquo; you could make involving the IFS, but I&rsquo;m just not there yet knowledge-wise.</p>
<p>As an experiment, I expanded upon this simple script to grab an entire library and generate a basic git repository :
<a href=https://github.com/barrettotte/IBMi-Lib-Repo>https://github.com/barrettotte/IBMi-Lib-Repo</a></p>
</div>
</article>
<footer id=footer>
<div class=footer-left>
&copy; 2022
<a href=/>Barrett Otte</a>
</div>
<div class=footer-right>
<nav>
<ul>
<li>
<a class=icon target=_blank rel=noopener href=mailto:barrettotte@gmail.com>
<i class="fas fa-lg fa-envelope"></i>
</a>
</li>
<li>
<a class=icon target=_blank rel=noopener href=https://github.com/barrettotte>
<i class="fab fa-lg fa-github"></i>
</a>
</li>
<li>
<a class=icon target=_blank rel=noopener href=https://www.linkedin.com/in/barrettotte/>
<i class="fab fa-lg fa-linkedin"></i>
</a>
</li>
<li>
<a class=icon target=_blank rel=noopener href="https://news.ycombinator.com/user?id=barrettotte">
<i class="fab fa-lg fa-hacker-news-square"></i>
</a>
</li>
</ul>
</nav>
</div>
</footer>
</div>
</body>
<link rel=stylesheet href=/lib/font-awesome/css/all.min.css>
<script src=/lib/jquery/jquery.min.js></script>
<script src=/js/code-copy.js></script>
</html>